<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="nl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>RegelRecht Demo</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/htmx/1.9.10/htmx.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <script type="module" src="/nl-wallet-files/nl-wallet-web.iife.js"></script>
        <link rel="stylesheet" href="/static/css/nl-wallet-button.css"></link>
    <script defer
            src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js"></script>
    <style>
        /* HTMX Indicator styles - hide the indicator by default */
        .htmx-indicator {
            opacity: 0;
            transition: opacity 200ms ease-in;
            pointer-events: none; /* Prevent interaction with the indicator */
        }

        /* Show the indicator when the target element is being requested */
        .htmx-request .htmx-indicator {
            opacity: 1;
        }

        .htmx-request.htmx-indicator {
            opacity: 1;
        }

        /* Ensure dropdowns work correctly */
        [x-cloak] {
            display: none !important;
        }


    </style>
    <script>
        function attach_wallet_handlers() {
            const wallet_button = document.getElementsByTagName("nl-wallet-button").item(0);
            if (wallet_button) {
                console.log('attaching nl-wallet-button handlers');
                wallet_button.addEventListener("success", wallet_done, false);
                wallet_button.addEventListener("failed", wallet_done, false);
            } else {
                console.log('no nl-wallet-button found');
            }
        }

        window.wallet_done = (e) => {
            if (!(e.detail && e.detail.length > 1)) {
                console.warn("missing event details")
                return;
            }

            const session_token = e.detail[0];
            const session_type = e.detail[1];

            if (session_type !== "cross_device") {
                return;
            }

            // Get bsn, law, and service from URL params or form inputs
            const urlParams = new URLSearchParams(window.location.search);
            const bsn = urlParams.get('bsn') || '{{ bsn }}' || '100000001';
            let service = urlParams.get('service') || '';
            let law = urlParams.get('law') || '';

            // If not found in URL, check form inputs
            if (!service || !law) {
                const serviceInput = document.querySelector('input[name="service"]');
                const lawInput = document.querySelector('input[name="law"]');

                if (serviceInput) service = serviceInput.value;
                if (lawInput) law = lawInput.value;
            }

            // Use HTMX to make the request with plain object (HTMX will form-encode it)
            htmx.ajax('POST', '/wallet/attributes', {
                target: '#application-panel',
                swap: 'innerHTML',
                values: {
                    session_token: session_token,
                    bsn: bsn,
                    law: law,
                    service: service
                }
            });
        };
    </script>
    <link rel="icon"
          type="image/png"
          href="/static/img/favicon-96x96.png"
          sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/static/img/favicon.svg" />
    <link rel="shortcut icon" href="/static/img/favicon.ico" />
    <link rel="apple-touch-icon"
          sizes="180x180"
          href="/static/img/apple-touch-icon.png" />
    <link rel="manifest" href="/static/img/site.webmanifest" />
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Proof of Concept Ribbon -->
    <button onclick="localStorage.removeItem('regelrecht-banner-dismissed'); location.reload();"
            class="fixed z-[10000] w-[180px] top-[30px] right-[-50px] text-center text-[15px] font-medium py-[5px] bg-[#FACC15] text-black transform rotate-45 origin-center shadow-md hover:bg-[#EAB308] transition-colors no-underline cursor-pointer border-0">
        Proof of Concept
    </button>
    <!-- Header -->
    <header class="bg-linear-to-br from-blue-600 to-blue-800 text-white"
            x-data="{ mobileMenuOpen: false }">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- Mobile Menu Button (Left Side) -->
                <button class="lg:hidden focus:outline-none cursor-pointer"
                        @click="mobileMenuOpen = !mobileMenuOpen"
                        aria-label="Toon/verberg menu">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         class="h-6 w-6"
                         fill="none"
                         viewBox="0 0 24 24"
                         stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <!-- Left side with Logo and Nav -->
                <div class="flex items-center flex-1 justify-center lg:justify-start">
                    <h1 class="text-2xl font-semibold">
                        <a href="/" class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 class="w-8 h-8 mr-3"
                                 viewBox="0 0 24 24">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                                <path d="M12 13a3 3 0 1 0 0-6a3 3 0 0 0 0 6" />
                                <path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9-9 9s-9-1.8-9-9s1.8-9 9-9" />
                                <path d="M6 20.05V20a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v.05" />
                                </g>
                            </svg>
                            RegelRecht
                        </a>
                    </h1>
                    <!-- Desktop Navigation -->
                    <nav class="hidden lg:block ml-8">
                        <ul class="flex space-x-6">
                            <li>
                                <a href="/?bsn={{ bsn }}"
                                   class="text-white hover:text-blue-200 font-medium">Dashboard</a>
                            </li>
                            {% if chat_enabled %}
                                <li>
                                    <a href="/chat?bsn={{ bsn }}"
                                       class="text-white hover:text-blue-200 font-medium flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                        </svg>
                                        Chat
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                <!-- Right side: Desktop Profile & More menu -->
                <div class="hidden lg:flex items-center space-x-2">
                    <!-- Desktop User Switcher -->
                    <div class="relative"
                         x-data="{ profileSelectorOpen: false, selectedProfile: '{{ bsn }}' }">
                        <!-- DigiD Indicator with integrated logo -->
                        <div class="flex items-center space-x-2 bg-white text-gray-900 px-4 py-2 rounded w-[350px] cursor-pointer border border-gray-300 hover:border-blue-500"
                             @click="profileSelectorOpen = !profileSelectorOpen">
                            <!-- DigiD logo -->
                            <div class="w-9 h-9 rounded-lg overflow-hidden flex-shrink-0">
                                <img src="/static/img/digid-logo.svg" alt="DigiD" class="w-full h-full" />
                            </div>
                            <div class="flex-grow truncate">
                                <div class="font-semibold">
                                    {{ all_profiles[bsn].name if bsn in all_profiles else "Selecteer
                                    profiel" }}
                                </div>
                                <div class="text-xs text-gray-500 truncate">
                                    {{ all_profiles[bsn].description if bsn in
                                    all_profiles else "" }}
                                </div>
                            </div>
                            <div class="flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     class="h-5 w-5 text-gray-500"
                                     viewBox="0 0 20 20"
                                     fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <!-- Desktop Dropdown Menu -->
                        <div x-show="profileSelectorOpen"
                             x-cloak
                             @click.away="profileSelectorOpen = false"
                             class="absolute right-0 mt-2 w-[450px] bg-white rounded-md shadow-lg z-50 py-1 text-sm max-h-96 overflow-y-auto">
                            <div class="px-3 py-2 text-xs font-medium text-gray-500 border-b border-gray-200">
                                Gesimuleerde
                                DigiD Profielen
                            </div>
                            {% for bsn_key, profile_data in all_profiles.items() %}
                                {% if profile_data.get('type') != 'onderneming' %}
                                    <a href="/?bsn={{ bsn_key }}"
                                       class="flex items-center px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 {% if bsn == bsn_key %}bg-blue-50{% endif %}">
                                        <div class="flex-shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                 class="h-8 w-8 text-gray-400"
                                                 viewBox="0 0 24 24"
                                                 fill="currentColor">
                                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z" />
                                            </svg>
                                        </div>
                                        <div class="ml-3">
                                            <div class="font-medium text-gray-900">{{ profile_data.name }}</div>
                                            <div class="text-sm text-gray-500">{{ profile_data.description }}</div>
                                            {% if profile_data.get('properties') %}
                                                <div class="flex flex-wrap gap-1 mt-1">
                                                    {% for property in profile_data.properties %}
                                                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                            {{ property }}
                                                        </span>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                            {% if profile_data.get('details') %}
                                                <div class="text-xs text-gray-400 mt-1">{{ profile_data.details }}</div>
                                            {% endif %}
                                        </div>
                                        {% if bsn == bsn_key %}
                                            <div class="ml-auto">
                                                <svg class="h-5 w-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                                </svg>
                                            </div>
                                        {% endif %}
                                    </a>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <!-- Delegation Context Switcher -->
                    {% include "components/delegation_switcher.html" %}
                    <!-- Desktop Kebab Menu (vertical ellipsis) -->
                    <!-- Dropdown Menu Wrapper for Homepage -->
                    <div class="homepage-dropdown-override">{% include "admin/partials/navigation_menu.html" %}</div>
                    <!-- Additional styles for homepage dropdown -->
                    <style>
                            .homepage-dropdown-override button {
                                background-color: transparent;
                            }
                            .homepage-dropdown-override button svg {
                                color: white;
                            }
                            .homepage-dropdown-override button:hover {
                                background-color: rgba(30, 64, 175, 0.8); /* blue-800 with transparency */
                            }
                    </style>
                </div>
                <!-- Mobile Navigation Menu -->
                <div class="hidden">
                    <button @click="desktopMoreMenuOpen = !desktopMoreMenuOpen"
                            class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-blue-800 focus:outline-none cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             class="h-5 w-5 text-white"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                        </svg>
                    </button>
                </div>
                <div x-show="mobileMenuOpen"
                     x-cloak
                     class="lg:hidden absolute left-0 right-0 top-16 bg-blue-900 z-50 px-4 py-4 shadow-lg overflow-y-auto max-h-[80vh]">
                    <nav>
                        <ul class="space-y-4">
                            <li>
                                <a href="/?bsn={{ bsn }}"
                                   class="block text-white hover:text-blue-200 font-medium py-2">Dashboard</a>
                            </li>
                            {% if chat_enabled %}
                                <li>
                                    <a href="/chat?bsn={{ bsn }}"
                                       class="block text-white hover:text-blue-200 font-medium py-2 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                        </svg>
                                        Chat
                                    </a>
                                </li>
                            {% endif %}
                            <!-- More Menu for Mobile (Kebab Menu) -->
                            <li class="pt-4 border-t border-blue-800"
                                x-data="{ mobilemoreMenuOpen: false }">
                                <button @click="mobilemoreMenuOpen = !mobilemoreMenuOpen"
                                        class="w-full text-white hover:text-blue-200 font-medium py-2 flex items-center justify-between cursor-pointer">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                        </svg>
                                        Meer opties
                                    </div>
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                         class="h-5 w-5"
                                         viewBox="0 0 20 20"
                                         fill="currentColor"
                                         :class="{ 'transform rotate-180': mobilemoreMenuOpen }">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <!-- Mobile More Dropdown Menu -->
                                <div x-show="mobilemoreMenuOpen" x-cloak class="bg-blue-800">
                                    <a href="/"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                        </svg>
                                        Homepage
                                    </a>
                                    <a href="/admin"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                        </svg>
                                        Zaaksysteem
                                    </a>
                                    <a href="/admin/control"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        Admin beheer
                                    </a>
                                    <a href="/simulation"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                        Simulatie
                                    </a>
                                    <a href="/analysis/laws/"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="w-5 h-5 mr-1"
                                             viewBox="0 0 24 24">
                                            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 21h7a2 2 0 0 0 2-2V9.414a1 1 0 0 0-.293-.707l-5.414-5.414A1 1 0 0 0 12.586 3H7a2 2 0 0 0-2 2v11m0 5l4.879-4.879m0 0a3 3 0 1 0 4.243-4.242a3 3 0 0 0-4.243 4.242" />
                                        </svg>
                                        Wet-details
                                    </a>
                                    <a href="/analysis/graph/"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             fill="none"
                                             viewBox="0 0 24 24"
                                             stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                        </svg>
                                        Graaf analyse
                                    </a>
                                    <a href="/importer"
                                       class="block text-white hover:text-blue-200 font-medium py-2 pl-8 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5 mr-1"
                                             viewBox="0 0 24 24">
                                            <path fill="currentColor" fill-rule="evenodd" d="M12 2.25a.75.75 0 0 1 .75.75v.756a49 49 0 0 1 9.152 1a.75.75 0 0 1-.152 1.485h-1.918l2.474 10.124a.75.75 0 0 1-.375.84A6.7 6.7 0 0 1 18.75 18a6.7 6.7 0 0 1-3.181-.795a.75.75 0 0 1-.375-.84l2.474-10.124H12.75v13.28c1.293.076 2.534.343 3.697.776a.75.75 0 0 1-.262 1.453h-8.37a.75.75 0 0 1-.262-1.453c1.162-.433 2.404-.7 3.697-.775V6.24H6.332l2.474 10.124a.75.75 0 0 1-.375.84A6.7 6.7 0 0 1 5.25 18a6.7 6.7 0 0 1-3.181-.795a.75.75 0 0 1-.375-.84L4.168 6.241H2.25a.75.75 0 0 1-.152-1.485a49 49 0 0 1 9.152-1V3a.75.75 0 0 1 .75-.75m4.878 13.543l1.872-7.662l1.872 7.662zm-9.756 0L5.25 8.131l-1.872 7.662z" clip-rule="evenodd" />
                                        </svg>
                                        Wet-importer
                                    </a>
                                </div>
                            </li>
                            <!-- Mobile Profile Switcher Header -->
                            <li class="pt-4 border-t border-blue-800">
                                <div class="flex items-center text-xs font-medium text-blue-300 uppercase py-2">Profiel Wisselen</div>
                                <div x-data="{ mobileProfilesOpen: false }" class="relative">
                                    <button @click="mobileProfilesOpen = !mobileProfilesOpen"
                                            class="w-full flex items-center justify-between bg-blue-700 hover:bg-blue-600 text-white px-3 py-2 rounded cursor-pointer">
                                        <div class="flex items-center">
                                            <div class="w-6 h-6 mr-2 rounded-md overflow-hidden">
                                                <img src="/static/img/digid-logo.svg" alt="DigiD" class="w-full h-full" />
                                            </div>
                                            {{ all_profiles[bsn].name if bsn in all_profiles else "Selecteer profiel" }}
                                        </div>
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                             class="h-5 w-5"
                                             viewBox="0 0 20 20"
                                             fill="currentColor">
                                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                    <!-- Mobile Profile Dropdown -->
                                    <div x-show="mobileProfilesOpen"
                                         x-cloak
                                         class="bg-white rounded-md shadow-lg mt-1 py-1 text-sm max-h-96 overflow-y-auto">
                                        <div class="px-3 py-2 text-xs font-medium text-gray-500 border-b border-gray-200">Gesimuleerde DigiD Profielen</div>
                                        {% for bsn_key, profile_data in all_profiles.items() %}
                                            {% if profile_data.get('type') != 'onderneming' %}
                                                <a href="/?bsn={{ bsn_key }}"
                                                   class="flex items-center px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-100 {% if bsn == bsn_key %}bg-blue-50{% endif %}">
                                                    <div class="flex-shrink-0">
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                             class="h-8 w-8 text-gray-400"
                                                             viewBox="0 0 24 24"
                                                             fill="currentColor">
                                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20z" />
                                                        </svg>
                                                    </div>
                                                    <div class="ml-3">
                                                        <div class="font-medium text-gray-900">{{ profile_data.name }}</div>
                                                        <div class="text-sm text-gray-500">{{ profile_data.description }}</div>
                                                        {% if profile_data.get('properties') %}
                                                            <div class="flex flex-wrap gap-1 mt-1">
                                                                {% for property in profile_data.properties %}
                                                                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                                        {{ property }}
                                                                    </span>
                                                                {% endfor %}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                    {% if bsn == bsn_key %}
                                                        <div class="ml-auto">
                                                            <svg class="h-5 w-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                                            </svg>
                                                        </div>
                                                    {% endif %}
                                                </a>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main class="container mx-auto px-4 py-8">
        <div id="dashboard-content" class="relative">
            {% block content %}{% endblock %}
        </div>
    </main>
    <!-- Shared Application Panel -->
    <div id="shared-application-panel"></div>
    <script>
        // Global ESC key handler for closing the panel
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                document.dispatchEvent(new CustomEvent('close-panel'));
            }
        });

        // Listen for Ctrl-R / Cmd-R when inside iframe and notify parent
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                // Check if we're inside an iframe
                if (window !== window.parent) {
                    e.preventDefault(); // Prevent full page refresh
                    window.parent.postMessage({ type: 'refresh-iframe' }, window.location.origin);
                    console.log('Sent refresh-iframe message to parent');
                }
                // If not in iframe, allow normal browser refresh
            }
        });
    </script>
    <!-- Footer -->
    <footer class="bg-gray-100 border-t mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">RegelRecht</h4>
                    <p class="text-gray-600">Een demonstratie van Nederlandse wetgeving als uitvoerbare code</p>
                    <a href="https://minbzk.github.io/regelrecht"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="text-blue-600 hover:text-blue-800 text-sm flex items-center mt-2">
                        Bezoek de RegelRecht website
                        <svg class="w-4 h-4 ml-1"
                             fill="none"
                             stroke="currentColor"
                             viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-4">Disclaimer</h4>
                    <p class="text-gray-600 text-sm">
                        Dit is een proof of concept. Alle gegevens zijn fictief.
                        Niet gebruiken voor daadwerkelijke besluitvorming.
                    </p>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-200 text-center text-gray-500 text-xs">
                Â© 2025 RegelRecht Demo | <span class="cursor-pointer hover:underline">v1.0.0</span>
            </div>
        </div>
    </footer>
</body>
</html>
