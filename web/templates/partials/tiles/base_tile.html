<!-- Modified version of base_tile.html with improved button styling -->
{% from "macros/logos.html" import org_logo %}

{# Define color map for services #}
{% set color_map = {
'TOESLAGEN': 'green',
'GEMEENTE_AMSTERDAM': 'purple',
'KIESRAAD': 'blue',
'SVB': 'blue'
} %}

<div class="law-result-card min-h-64 bg-white rounded-lg shadow"
     x-data="{ showExplanation: false }"
     @close-explanation.window="showExplanation = false"
     id="tile-{{ law|replace('/', '-') }}">
    <div class="p-6 flex flex-col h-full">
        {% if requirements_met %}
        <div class="flex-grow space-y-6">
            <div class="flex items-start justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">
                        {{ rule_spec.name }}
                    </h3>
                    {% if current_claim %}
                    <div class="mt-2">
                        {% include "partials/tiles/components/claim_status_badge.html" %}
                    </div>
                    {% endif %}
                </div>
                <div class="flex items-start space-x-2">
                    {{ org_logo(service) }}
                </div>
            </div>

            {% block tile_content %}
            <div class="space-y-4">
                <div class="text-gray-600">
                    {% if result and result.hoogte_toeslag is defined %}
                    Uw {{ rule_spec.name|lower }} is waarschijnlijk
                    <div class="text-2xl font-semibold text-{{ color_map.get(service, 'gray') }}-700 mt-1">
                        € {{ "%.2f"|format(result.hoogte_toeslag/100) }}
                        <span class="text-sm font-normal text-gray-500">per jaar</span>
                    </div>
                    {% elif result and result.amount is defined %}
                    Uw {{ rule_spec.name|lower }} is waarschijnlijk
                    <div class="text-2xl font-semibold text-{{ color_map.get(service, 'gray') }}-700 mt-1">
                        € {{ "%.2f"|format(result.amount/100) }}
                        <span class="text-sm font-normal text-gray-500">per maand</span>
                    </div>
                    {% endif %}

                    {% if not current_claim %}
                    <button
                            hx-post="/laws/submit-claim?service={{ service }}&law={{ law|urlencode }}&bsn={{ bsn }}"
                            hx-target="closest div.law-result-card"
                            class="w-full mt-4 px-4 py-2.5 bg-{{ color_map.get(service, 'blue') }}-100 hover:bg-{{ color_map.get(service, 'blue') }}-200 text-{{ color_map.get(service, 'blue') }}-700 font-medium text-sm rounded-md transition-colors">
                        {{ rule_spec.name }} aanvragen
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endblock %}

            {% include "partials/tiles/components/next_steps.html" %}
        </div>

        <div class="mt-6">
            {% block actions %}
            {% if not current_claim %}
            {% block submit_button %}
            <button
                    hx-post="/laws/submit-claim?service={{ service }}&law={{ law|urlencode }}&bsn={{ bsn }}"
                    hx-target="closest div.law-result-card"
                    class="w-full px-6 py-3 bg-blue-600 text-white text-center rounded-md hover:bg-blue-700 transition-colors">
                Aanvragen
            </button>
            {% endblock %}
            {% elif current_claim.status == 'SUBMITTED' %}
            {% block submitted_status %}
            <p class="text-sm text-gray-600 text-center">
                Heeft u vragen? Klik hier, of bel 1234.
            </p>
            {% endblock %}
            {% elif current_claim.status == 'APPROVED' %}
            {% block approved_status %}
            <p class="text-sm text-green-600 text-center">Uw aanvraag is goedgekeurd</p>
            {% endblock %}
            {% elif current_claim.status == 'DENIED' and current_claim.can_appeal() %}
            {% block appeal_button %}
            <div class="space-y-4">
                <button
                        hx-post="/laws/submit-appeal?claim_id={{ current_claim.id }}"
                        hx-target="closest div.min-h-[16rem]"
                        class="w-full px-6 py-3 bg-red-600 text-white text-center rounded-md hover:bg-red-700 transition-colors">
                    In bezwaar gaan
                </button>
                {% if current_claim.meta_claims.get('appeal_window') %}
                <p class="text-xs text-gray-600 text-center">
                    U kunt binnen {{ current_claim.meta_claims.appeal_window.value }} dagen bezwaar maken tegen deze
                    beslissing
                </p>
                {% endif %}
            </div>
            {% endblock %}
            {% endif %}
            {% endblock %}
        </div>
        {% else %}
        <div class="flex-grow space-y-6">
            <div class="flex items-start justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">
                        {{ rule_spec.name }}
                    </h3>
                    <h4 class="text-sm font-medium text-gray-500 mb-1">
                        U komt niet in aanmerking
                        <button
                                @click="showExplanation = true"
                                class="ml-4 text-sm text-gray-400 hover:text-gray-900 border-b border-dotted border-gray-300 hover:border-gray-600"
                                hx-get="/laws/explain-path?service={{ service }}&law={{ law|urlencode }}&bsn={{ bsn }}"
                                hx-target="#explanation-panel-{{ law|replace('/', '-') }}"
                                hx-swap="innerHTML">
                            waarom?
                        </button>
                    </h4>

                </div>
                <div class="-mt-2 -mr-2">{{ org_logo(service) }}</div>
            </div>
        </div>

        <div class="mt-6">
            {% block not_eligible_questions %}
            <p class="text-sm text-gray-600 text-center">
                Heeft u vragen? Klik hier, of bel 1234.
            </p>
            {% endblock %}
        </div>

        {% endif %}
    </div>
    <div id="explanation-panel-{{ law|replace('/', '-') }}"
         @click.outside="showExplanation = false">
    </div>
</div>
