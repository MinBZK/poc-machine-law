{% from "macros/logos.html" import org_logo %}
{# Custom standalone template for Terrasvergunning - demonstrates claims flow for missing data #}
<div class="law-result-card min-h-64 bg-white rounded-lg shadow"
     x-data="{ showExplanation: false }"
     @close-explanation.window="showExplanation = false"
     id="tile-{{ law|replace('/', '-') }}">
    <div class="p-6 flex flex-col h-full">
        <div class="flex-grow space-y-6">
            <!-- Header -->
            <div class="flex items-start justify-between border-b border-gray-100 pb-4">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">{{ rule_spec.name }}</h3>
                    {% if current_case %}
                        <div class="mt-2">{% include "partials/tiles/components/case_status_badge.html" %}</div>
                    {% endif %}
                </div>
                <div class="-mt-2 -mr-2">{{ org_logo(service) }}</div>
            </div>

            <!-- Main Content -->
            <div class="space-y-6">
                {% include "partials/tiles/law/algemene_plaatselijke_verordening/terrassen/GEMEENTE_ROTTERDAM/computation.html" %}
            </div>
        </div>

        <!-- Actions Section -->
        <div class="mt-6 pt-4 border-t border-gray-100">
            {% if current_case and current_case.status == 'IN_REVIEW' %}
                {# Application is under review - show process steps #}
                <div class="bg-blue-50 border border-blue-100 rounded-lg p-4">
                    <h4 class="font-medium text-blue-900 mb-3">Wat gebeurt er nu?</h4>
                    <ol class="space-y-2 text-sm text-blue-800">
                        <li class="flex items-start">
                            <span class="font-medium mr-2">1.</span>
                            <span>Een medewerker bekijkt uw aanvraag binnen 5 werkdagen</span>
                        </li>
                        <li class="flex items-start">
                            <span class="font-medium mr-2">2.</span>
                            <span>U krijgt mogelijk een uitnodiging voor een gesprek</span>
                        </li>
                        <li class="flex items-start">
                            <span class="font-medium mr-2">3.</span>
                            <span>Binnen 6 weken ontvangt u bericht over uw aanvraag</span>
                        </li>
                    </ol>
                </div>
            {% elif current_case and current_case.status == 'DECIDED' and current_case.approved %}
                {# Application approved #}
                <div class="bg-green-50 border border-green-100 rounded-lg p-4">
                    <p class="text-green-800 font-medium">Uw terrasvergunning is goedgekeurd!</p>
                </div>
            {% elif requirements_met %}
                {# All requirements met - can apply #}
                <button hx-get="/laws/application-panel?service={{ service }}&law={{ law|urlencode }}&bsn={{ effective_bsn|default(bsn) }}&default_tab=application"
                        hx-target="#shared-application-panel"
                        hx-swap="innerHTML"
                        class="w-full px-6 py-3 bg-green-600 text-white text-center rounded-md hover:bg-green-700 transition-colors cursor-pointer">
                    Terrasvergunning aanvragen
                </button>
            {% else %}
                {# Missing data - show claims flow option #}
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h4 class="font-medium text-yellow-900 mb-2">Gegevens aanvullen nodig</h4>
                    <p class="text-sm text-yellow-800 mb-4">
                        Voor deze aanvraag hebben we extra informatie nodig over de stoepbreedte bij uw vestiging.
                        U kunt deze gegevens zelf aanleveren.
                    </p>
                    <button hx-get="/laws/application-panel?service={{ service }}&law={{ law|urlencode }}&bsn={{ effective_bsn|default(bsn) }}&default_tab=application"
                            hx-target="#shared-application-panel"
                            hx-swap="innerHTML"
                            class="w-full px-4 py-2 bg-yellow-600 text-white text-center rounded-md hover:bg-yellow-700 transition-colors cursor-pointer">
                        Gegevens aanleveren
                    </button>
                </div>
            {% endif %}
        </div>
    </div>
</div>
<script>
    // Listen for the close-panel event and close the shared panel
    document.addEventListener('close-panel', function() {
        const panel = document.getElementById('shared-application-panel');
        if (panel) {
            panel.innerHTML = '';
        }
    });
</script>
