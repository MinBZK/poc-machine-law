{# Custom input form for Geluidsontheffing - collect activity date #}
<div class="space-y-4 border-t border-blue-200 pt-4 mb-4">
    <h4 class="font-medium text-gray-900">Geluidsontheffing aanvragen</h4>
    <form hx-post="/edit/update-missing-values"
          hx-target="#application-panel"
          hx-swap="innerHTML"
          class="space-y-4">
        <input type="hidden" name="service" value="{{ service }}">
        <input type="hidden" name="law" value="{{ law }}">
        <input type="hidden" name="bsn" value="{{ bsn }}">
        <input type="hidden" name="reason" value="Geluidsontheffing aangevraagd door ondernemer">
        <input type="hidden" name="claimant" value="{{ bsn }}">
        {# Activiteitsdatum input #}
        <div>
            <label for="activiteitsdatum" class="block text-sm font-medium text-gray-700 mb-1">
                Datum van de avond waarvoor u ontheffing aanvraagt
            </label>
            <p class="text-xs text-gray-500 mb-2">
                Selecteer de datum waarop u geluid wilt maken na 22:00 uur.
            </p>
            <input type="date"
                   id="activiteitsdatum"
                   name="values[0]"
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                   required>
            <input type="hidden" name="keys[0]" value="ACTIVITEITSDATUM">
            <input type="hidden" name="types[0]" value="date">
        </div>
        {# Submit button #}
        <div class="flex gap-2 pt-2">
            <button type="button"
                    @click="document.getElementById('shared-application-panel').innerHTML = ''; document.dispatchEvent(new CustomEvent('close-panel'))"
                    class="w-full px-4 py-2 bg-gray-400 text-white text-center rounded-md hover:bg-gray-500 transition-colors cursor-pointer">
                Annuleren
            </button>
            <button type="submit"
                    class="w-full px-4 py-2 bg-green-600 text-white text-center rounded-md hover:bg-green-700 transition-colors cursor-pointer">
                Ontheffing aanvragen
            </button>
        </div>
    </form>
</div>
{# Show historie of previous ontheffingen #}
{% if profile_data and profile_data.ontheffingen_geluid_historie %}
    <div class="border-t border-blue-200 pt-4">
        <h4 class="font-medium text-gray-900 mb-3">Eerder verleende ontheffingen dit jaar</h4>
        <div class="space-y-2">
            {% for ontheffing in profile_data.ontheffingen_geluid_historie %}
                {% if ontheffing.kvk_nummer == kvk %}
                    <div class="flex items-center justify-between bg-gray-50 rounded-lg px-3 py-2">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 text-green-500 mr-2"
                                 fill="none"
                                 stroke="currentColor"
                                 viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            <span class="text-sm text-gray-700">{{ ontheffing.datum }}</span>
                        </div>
                        <span class="text-sm text-gray-500">{{ ontheffing.reden }}</span>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endif %}
