{% extends "partials/tiles/base_tile.html" %}
{% block tile_content %}
    {% include "partials/tiles/law/algemene_plaatselijke_verordening/exploitatievergunning/GEMEENTE_ROTTERDAM/computation.html" %}
{% endblock %}
{% block actions %}
    {# Check profile_data for existing vergunning status - using namespace for Jinja2 loop scoping #}
    {% set ns = namespace(vergunning_info=none) %}
    {% if profile_data and profile_data.vergunningen %}
        {% for v in profile_data.vergunningen %}
            {% if v.kvk_nummer == kvk and v.heeft_exploitatievergunning %}
                {% set ns.vergunning_info = v %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {# Exploitatievergunning has already been granted, so show status instead of action buttons #}
    {% if ns.vergunning_info %}
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <div class="flex items-center">
                <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <span class="text-green-800 font-medium">Vergunning geldig voor 5 jaar</span>
            </div>
            <p class="text-sm text-green-700 mt-1 ml-7">
                Verleend op: <strong>{{ ns.vergunning_info.datum_verleend|format_date }}</strong>
            </p>
        </div>
    {% else %}
        {{ super() }}
    {% endif %}
{% endblock %}
{% block submit_button %}
    {% if can_submit_claims|default(true) and not result.heeft_exploitatievergunning %}
        <button hx-get="/laws/application-panel?service={{ service }}&law={{ law|urlencode }}&bsn={{ effective_bsn|default(bsn) }}&default_tab=application"
                hx-target="#shared-application-panel"
                hx-swap="innerHTML"
                class="w-full px-6 py-3 bg-green-600 text-white text-center rounded-md hover:bg-green-700 transition-colors cursor-pointer">
            Exploitatievergunning aanvragen
        </button>
    {% endif %}
{% endblock %}
{% block approved_status %}
    <p class="text-sm text-green-600 text-center">
        Uw exploitatievergunning is verleend en actief.
    </p>
{% endblock %}
