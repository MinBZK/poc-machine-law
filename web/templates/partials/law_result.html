<!-- templates/partials/law_result.html -->
{% from "macros/logos.html" import org_logo %}

<div class="law-result-card min-h-64 bg-white rounded-lg shadow">
    {% if error %}
    <div class="p-6">
        <div class="flex items-start justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                    {{ rule_spec.name }}
                </h3>
                <p class="text-red-600">Er is een fout opgetreden bij het berekenen</p>
            </div>
            <div class="p-2">{{ org_logo(service) }}</div>
        </div>
    </div>

    {% elif requirements_met %}
    <div class="p-6 flex flex-col h-full">
        <div class="flex-grow">
            <div class="flex items-start justify-between">
                <h3 class="text-lg font-semibold text-gray-900">
                    {{ rule_spec.name }}
                </h3>
                <div class="-mt-2 -mr-2">{{ org_logo(service) }}</div>
            </div>

            {% if current_claim %}
            <div class="mb-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                    {% if current_claim.status.value == 'SUBMITTED' %}
                        bg-blue-100 text-blue-800
                    {% elif current_claim.status.value == 'UNDER_REVIEW' %}
                        bg-yellow-100 text-yellow-800
                    {% elif current_claim.status.value == 'APPROVED' %}
                        bg-green-100 text-green-800
                    {% elif current_claim.status.value == 'DENIED' %}
                        bg-red-100 text-red-800
                    {% elif current_claim.status.value == 'APPEALED' %}
                        bg-purple-100 text-purple-800
                    {% endif %}
                ">
                    {{ current_claim.status.value|replace('_', ' ')|title }}
                </span>
            </div>
            {% endif %}

            {% if service == "KIESRAAD" and law.endswith("kieswet") %}
            <p class="text-gray-600">
                Voor de verkiezingen van <strong>{{ input['$ELECTION_DATE']|format_date }}</strong> heeft u
            </p>
            {% if result.has_voting_rights %}
            <p class="text-4xl font-bold text-pink-600 mt-2">
                STEMRECHT
            </p>
            {% else %}
            <p class="text-4xl font-bold text-pink-600 mt-2">
                GEEN stemrecht
            </p>
            {% endif %}

            {% elif service == "TOESLAGEN" and law.endswith("zorgtoeslagwet") and result.is_verzekerde_zorgtoeslag %}
            <p class="text-gray-600">Uw jaarlijkse zorgtoeslag</p>
            <p class="text-4xl font-bold text-green-600 mt-2">
                € {{ "%.2f"|format(result.hoogte_toeslag / 100) }}
            </p>

            {% elif service == "SVB" and law.endswith("algemene_ouderdomswet") and result.pension_amount %}
            <p class="text-gray-600">Uw maandelijkse AOW pensioen</p>
            <p class="text-4xl font-bold text-blue-600 mt-2">
                € {{ "%.2f"|format(result.pension_amount / 100) }}
            </p>

            {% elif service == "GEMEENTE_AMSTERDAM" and law.endswith("participatiewet/bijstand") %}
            <p class="text-gray-600">Uw maandelijkse bijstandsuitkering</p>
            {% if result.benefit_amount %}
            <p class="text-4xl font-bold text-purple-600 mt-2">
                € {{ "%.2f"|format(result.benefit_amount / 100) }}
            </p>
            {% endif %}
            {% endif %}
        </div>

        <div class="mt-6">
            {% if not current_claim %}
            <button
                    hx-post="/laws/submit-claim?service={{ service }}&law={{ law|urlencode }}&bsn={{ bsn }}"
                    hx-target="closest div.law-result-card"
                    class="w-full px-6 py-3 bg-blue-600 text-white text-center rounded-md hover:bg-blue-700 transition-colors">
                Aanvragen
            </button>
            {% elif current_claim.status.value == 'SUBMITTED' %}
            <p class="text-sm text-gray-600 text-center">Uw aanvraag wordt beoordeeld</p>
            {% elif current_claim.status.value == 'APPROVED' %}
            <p class="text-sm text-green-600 text-center">Uw aanvraag is goedgekeurd</p>
            {% elif current_claim.status.value == 'DENIED' and current_claim.can_appeal() %}
            <button
                    hx-post="/laws/submit-appeal?claim_id={{ current_claim.id }}"
                    hx-target="closest div.min-h-[16rem]"
                    class="w-full px-6 py-3 bg-red-600 text-white text-center rounded-md hover:bg-red-700 transition-colors">
                In bezwaar gaan
            </button>
            {% endif %}
        </div>
    </div>

    {% else %}
    <div class="p-6">
        <div class="flex items-start justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                    {{ rule_spec.name }}
                </h3>
                <p class="text-gray-600">
                    U komt niet in aanmerking
                </p>
            </div>
            <div class="-mt-2 -mr-2">{{ org_logo(service) }}</div>
        </div>
    </div>
    {% endif %}
</div>
