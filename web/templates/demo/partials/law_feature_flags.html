{% macro render_law_item(section_name, section_label, laws, badge_class) %}
    {% if laws %}
        <div class="law-menu-item"
             x-data="{ open: false }"
             @mouseenter="open = true"
             @mouseleave="open = false">
            <div class="law-menu-trigger">
                <span>{{ section_label }}</span>
                <span class="law-badge {{ badge_class }}">{{ laws|length }}</span>
                <span class="law-chevron" :class="{ 'open': open }">â–¾</span>
            </div>
            <div class="law-submenu" x-show="open" x-collapse.duration.150ms>
                {% for service, service_laws in laws.items() %}
                    <div class="law-service-group">
                        <span class="law-service-name">{{ service|replace('_', ' ') |title }}</span>
                        {% for law_name, enabled in service_laws.items() %}
                            {% set sanitized_law_name = law_name|replace('/', '__') %}
                            <div class="law-toggle-row">
                                <span class="law-name {{ 'disabled' if not enabled }}">{{ law_name|replace('_', ' ') }}</span>
                                <button class="toggle-btn-mini {{ 'enabled' if enabled else '' }}"
                                        hx-post="/admin/set-feature-flag"
                                        hx-target="#demo-law-flags"
                                        hx-swap="innerHTML"
                                        hx-vals='{"flag_name": "LAW_{{ service }}_{{ sanitized_law_name }}", "value": "{{ '0' if enabled else '1' }}", "source": "demo-law"}'>
                                    <div class="toggle-knob"></div>
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endmacro %}
<div class="law-menu-list">
    {{ render_law_item('citizen', 'Burger', law_flags.citizen, 'blue') }}
    {{ render_law_item('business', 'Bedrijven', law_flags.business, 'green') }}
    {{ render_law_item('delegation', 'Delegatie', law_flags.delegation, 'purple') }}
</div>
<style>
.law-menu-list {
    display: flex;
    flex-direction: column;
}
.law-menu-item {
    position: relative;
}
.law-menu-trigger {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 13px;
    color: var(--text-primary, #333);
    transition: background 0.15s;
}
.law-menu-trigger:hover {
    background: var(--hover-bg, rgba(0,0,0,0.05));
}
.law-badge {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 500;
}
.law-badge.blue { background: #dbeafe; color: #1e40af; }
.law-badge.green { background: #dcfce7; color: #166534; }
.law-badge.purple { background: #f3e8ff; color: #6b21a8; }
.law-chevron {
    margin-left: auto;
    font-size: 10px;
    opacity: 0.6;
    transition: transform 0.15s;
}
.law-chevron.open {
    transform: rotate(180deg);
}

/* Submenu */
.law-submenu {
    background: var(--bg-secondary, #f9fafb);
    border-top: 1px solid var(--border-color, #eee);
    padding: 8px 12px 8px 20px;
    max-height: 250px;
    overflow-y: auto;
}
.law-service-group {
    margin-bottom: 8px;
}
.law-service-group:last-child {
    margin-bottom: 0;
}
.law-service-name {
    display: block;
    font-size: 10px;
    font-weight: 600;
    color: var(--text-muted, #888);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}
.law-toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 3px 0;
    font-size: 11px;
}
.law-name {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: var(--text-primary, #333);
    margin-right: 8px;
}
.law-name.disabled {
    color: var(--text-muted, #999);
}
</style>
