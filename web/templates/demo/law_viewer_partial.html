<div class="demo-layout">
    <!-- Toggle button when sidebar is collapsed -->
    <button class="sidebar-toggle-collapsed"
            id="laws-sidebar-toggle-collapsed"
            onclick="toggleLawsSidebar()">☰</button>
    <!-- Sidebar with law list -->
    <aside class="demo-sidebar collapsed" id="laws-sidebar">
        <button class="sidebar-toggle" onclick="toggleLawsSidebar()" style="display: none;">−</button>
        <div class="sidebar-header">
            <h2>Beschikbare Wetten</h2>
            <input type="text"
                   id="law-search"
                   class="law-search"
                   placeholder="Zoek wetten...">
        </div>
        <div class="law-list" id="law-list">
            {% for directory, laws in grouped_laws.items() %}
                <div class="law-directory">
                    <div class="directory-header" onclick="toggleDirectory(this)">
                        <span class="directory-icon">▼</span>
                        <span class="directory-name">{{ directory or "Root" }}</span>
                        <span class="directory-count">({{ laws|length }})</span>
                    </div>
                    <div class="directory-laws">
                        {% for law in laws %}
                            <a href="/demo/law/{{ law.path }}"
                               class="law-item {% if law.path == law_path %}active{% endif %}"
                               data-law="{{ law.law }}"
                               data-service="{{ law.service }}">
                                <div class="law-item-header">
                                    <span class="law-name">{{ law.name }}</span>
                                    <span class="law-service">{{ law.service }}</span>
                                </div>
                                <div class="law-item-meta">
                                    <span class="law-id">{{ law.law }}</span>
                                    <span class="law-date">{{ law.valid_from }}</span>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </aside>
    <!-- Main content area with YAML viewer -->
    <main class="demo-content">
        <div class="law-viewer">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <a href="/demo">Wetten</a>
                <span class="separator">/</span>
                <span class="current">{{ law_data.law }}</span>
            </div>
            <!-- Law header -->
            <div class="law-header">
                <h1>{{ law_data.name }}</h1>
                <div class="law-meta">
                    <span class="badge">{{ law_data.service }}</span>
                    <span class="badge">{{ law_data.law }}</span>
                    <span class="badge">Geldig vanaf: {{ law_data.valid_from }}</span>
                </div>
            </div>
            <!-- Toolbar -->
            <div class="law-toolbar">
                <button class="btn btn-secondary" onclick="collapseAll()">Alles inklappen</button>
            </div>
            <!-- YAML content -->
            <div class="yaml-content">{{ yaml_html | safe }}</div>
        </div>
    </main>
</div>
<script>
// Law search functionality
document.getElementById('law-search').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const lawItems = document.querySelectorAll('.law-item');

    lawItems.forEach(item => {
        const lawName = item.querySelector('.law-name').textContent.toLowerCase();
        const lawId = item.querySelector('.law-id').textContent.toLowerCase();
        const service = item.querySelector('.law-service').textContent.toLowerCase();

        if (lawName.includes(searchTerm) || lawId.includes(searchTerm) || service.includes(searchTerm)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
});

// Sidebar toggle functionality
function toggleLawsSidebar() {
    const sidebar = document.getElementById('laws-sidebar');
    const collapsedToggle = document.getElementById('laws-sidebar-toggle-collapsed');
    const sidebarToggle = sidebar.querySelector('.sidebar-toggle');

    sidebar.classList.toggle('collapsed');
    const isCollapsed = sidebar.classList.contains('collapsed');

    // Show/hide the toggle buttons
    collapsedToggle.style.display = isCollapsed ? 'block' : 'none';
    sidebarToggle.style.display = isCollapsed ? 'none' : 'block';

    // Save state to localStorage
    localStorage.setItem('lawsSidebarCollapsed', isCollapsed);
}

// Initialize sidebar state from localStorage on load
(function() {
    const sidebar = document.getElementById('laws-sidebar');
    const collapsedToggle = document.getElementById('laws-sidebar-toggle-collapsed');
    const sidebarToggle = sidebar.querySelector('.sidebar-toggle');
    const savedState = localStorage.getItem('lawsSidebarCollapsed');

    // Default to collapsed (true) if no saved state
    const isCollapsed = savedState === null ? true : savedState === 'true';

    if (isCollapsed) {
        sidebar.classList.add('collapsed');
        collapsedToggle.style.display = 'block';
        sidebarToggle.style.display = 'none';
    } else {
        sidebar.classList.remove('collapsed');
        collapsedToggle.style.display = 'none';
        sidebarToggle.style.display = 'block';
    }
})();
</script>
