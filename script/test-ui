#!/bin/bash
set -e

# Check if the server is already running
if ! curl -s http://0.0.0.0:8000 > /dev/null; then
    echo "ERROR: Web server is not running. Please start it first with:"
    echo "uv run web/main.py"
    exit 1
fi

# Default to all browsers if none specified
if [ -z "$1" ]; then
    echo "Running playwright tests on all browsers"
    echo "Supported browsers: chromium, firefox, webkit (Safari engine)"

    # Run tests for each browser using multiple --browser arguments
    # Add optimization flags: use xvfb for virtual display and run in parallel mode
    uv run pytest tests/playwright -v --browser=chromium --browser=firefox --browser=webkit -xvs
else
    # Run with specified browser
    echo "Running playwright tests with browser: $1"
    echo "Supported browsers: chromium, firefox, webkit (Safari engine)"
    uv run pytest tests/playwright -v --browser=$1 -xvs
fi
